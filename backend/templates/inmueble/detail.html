{% extends "base/base.html" %}
{% load static %}

{% block title %}Detalle de {{ inmueble.nombre }} - Property{% endblock %}

{% block content %}

<div class="container py-5">
    <div class="row">
        <!-- Columna de miniaturas -->
        <div class="col-md-1 d-flex flex-column">
            {% for imagen in inmueble.imagenes_inmueble.all %}
                <img src="{{ imagen.imagen.url }}" class="img-fluid mb-2 thumbnail-img" alt="Miniatura {{ forloop.counter }}" style="cursor:pointer;" onclick="cambiarImagen('{{ imagen.imagen.url }}')">
            {% endfor %}
        </div>

        <!-- Imagen principal -->
        <div class="col-md-5">
            {% if inmueble.imagenes_inmueble.first %}
                <img id="imagen-principal" src="{{ inmueble.imagenes_inmueble.first.imagen.url }}" class="img-fluid rounded" alt="{{ inmueble.nombre }}">
            {% else %}
                <img id="imagen-principal" src="{% static 'images/default.jpg' %}" class="img-fluid rounded" alt="Sin imagen">
            {% endif %}
        </div>

        <!-- Información del inmueble -->
        <div class="col-md-6">
            <h2 class="fw-bold">{{ inmueble.nombre }}</h2>
            <p>{{ inmueble.descripcion }}</p>
            <p><strong>Tipo:</strong> {{ inmueble.get_tipo_inmueble_display }}</p>
            <p><strong>Comuna:</strong> {{ inmueble.comuna.nombre }}</p>
            <p><strong>Región:</strong> {{ inmueble.comuna.region.nombre }}</p>
            <p><strong>Precio mensual:</strong> ${{ inmueble.precio_mensual }}</p>

            <!-- Botón de solicitar arriendo solo para arrendatarios y si no está arrendado y no hay solicitud previa -->
            {% if user.is_authenticated and user.tipo_usuario == "ARRENDATARIO" %}
                {% if not inmueble.arrendado and not solicitado %}
                    <a href="{% url 'solicitud_create' inmueble.id %}" class="btn btn-primary mt-3">
                        <i class="bi bi-file-earmark-text me-1"></i> Solicitar arriendo
                    </a>
                {% elif solicitado %}
                    <p class="text-success mt-3"><em>Ya enviaste una solicitud para este inmueble. Si tu solicitud es rechazada puedes volver a intentarlo.</em></p>
                {% else %}
                    <p class="text-danger mt-3"><em>Este inmueble ya está arrendado.</em></p>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>

<!-- JavaScript para cambiar la imagen principal -->
<script>
    function cambiarImagen(url) {
        document.getElementById('imagen-principal').src = url;
    }
</script>

{% endblock %}
