# Base image
FROM python:3.9-slim

# Evitar prompts y cache innecesario
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1

# Directorio de trabajo
WORKDIR /usr/src/app

# Copiar requirements.txt desde backend/
COPY backend/requirements.txt .

# Instalar dependencias
RUN pip install --upgrade pip && \
    pip install -r requirements.txt

# Copiar todo el contenido de backend/ al contenedor
COPY backend/ .

# Crear script de inicio para Render Free
RUN echo "#!/bin/bash\n\
python manage.py migrate && \\\n\
python manage.py collectstatic --noinput && \\\n\
python manage.py runserver 0.0.0.0:8000" > start.sh && \
    chmod +x start.sh

# CMD que Render ejecutar√° al levantar el contenedor
CMD ["./start.sh"]
